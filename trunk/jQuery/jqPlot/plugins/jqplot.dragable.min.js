(function(d){d.jqplot.Dragable=function(g){this.markerRenderer=new d.jqplot.MarkerRenderer({shadow:false});this.shapeRenderer=new d.jqplot.ShapeRenderer();this.isDragging=false;this._ctx;this._elem;this._point;this._gridData;this.color;this.contstrainTo="none";d.extend(true,this,g)};function b(){d.jqplot.GenericCanvas.call(this);this.isDragging=false;this._neighbor;this._cursor}b.prototype=new d.jqplot.GenericCanvas();b.prototype.constructor=b;d.jqplot.Dragable.parseOptions=function(i,h){var g=h||{};this.plugins.dragable=new d.jqplot.Dragable(g.dragable);this.isDragable=true};d.jqplot.Dragable.postPlotDraw=function(){this.plugins.dragable={};this.plugins.dragable.dragCanvas=new b();this.eventCanvas._elem.before(this.plugins.dragable.dragCanvas.createElement(this._gridPadding,"jqplot-dragable-canvas",this._plotDimensions));var g=this.plugins.dragable.dragCanvas.setContext()};d.jqplot.preParseSeriesOptionsHooks.push(d.jqplot.Dragable.parseOptions);d.jqplot.postDrawHooks.push(d.jqplot.Dragable.postPlotDraw);d.jqplot.eventListenerHooks.push(["jqplotMouseMove",e]);d.jqplot.eventListenerHooks.push(["jqplotMouseDown",c]);d.jqplot.eventListenerHooks.push(["jqplotMouseUp",a]);function f(o,q){var r=o.series[q.seriesIndex];var n=r.plugins.dragable;var h=r.markerRenderer;var i=n.markerRenderer;i.style=h.style;i.lineWidth=h.lineWidth+2.5;i.size=h.size+5;var m=d.jqplot.getColorComponents(h.color);var p=[m[0],m[1],m[2]];var l=(m[3]>=0.6)?m[3]*0.6:m[3]*(2-m[3]);var k="rgba("+p[0]+","+p[1]+","+p[2]+","+l+")";n.color=k;i.color=k;i.init();var g=(q.pointIndex>0)?q.pointIndex-1:0;var j=q.pointIndex+2;n._gridData=r.gridData.slice(g,j)}function e(n,k,h,r,l){if(l.plugins.dragable.dragCanvas.isDragging){var t=l.plugins.dragable.dragCanvas;var i=t._neighbor;var v=l.series[i.seriesIndex];var j=v.plugins.dragable;var q=v.gridData;var o=(j.constrainTo=="y")?i.gridData[0]:k.x;var m=(j.constrainTo=="x")?i.gridData[1]:k.y;var g=v._xaxis.series_p2u(o);var p=v._yaxis.series_p2u(m);var u=t._ctx;u.clearRect(0,0,u.canvas.width,u.canvas.height);if(i.pointIndex>0){j._gridData[1]=[o,m]}else{j._gridData[0]=[o,m]}l.series[i.seriesIndex].draw(t._ctx,{gridData:j._gridData,shadow:false,preventJqPlotSeriesDrawTrigger:true,color:j.color});t._elem.trigger("jqplotSeriesPointChange",[i.seriesIndex,i.pointIndex,[g,p],[o,m]])}}function c(k,i,g,l,j){var m=j.plugins.dragable.dragCanvas;m._cursor=k.target.style.cursor;if(l!=null){var o=j.series[l.seriesIndex];var h=o.plugins.dragable;if(o.isDragable&&!m.isDragging){m._neighbor=l;m.isDragging=true;f(j,l);h.markerRenderer.draw(o.gridData[l.pointIndex][0],o.gridData[l.pointIndex][1],m._ctx);k.target.style.cursor="move"}}else{var n=m._ctx;n.clearRect(0,0,n.canvas.width,n.canvas.height);m.isDragging=false}}function a(m,j,g,o,k){if(k.plugins.dragable.dragCanvas.isDragging){var p=k.plugins.dragable.dragCanvas;var q=p._ctx;q.clearRect(0,0,q.canvas.width,q.canvas.height);p.isDragging=false;var h=p._neighbor;var r=k.series[h.seriesIndex];var i=r.plugins.dragable;var n=(i.constrainTo=="y")?h.data[0]:g[r.xaxis];var l=(i.constrainTo=="x")?h.data[1]:g[r.yaxis];r.data[h.pointIndex]=[n,l];k.drawSeries(k.seriesCanvas._ctx,{preventJqPlotSeriesDrawTrigger:true});p._neighbor=null;m.target.style.cursor=p._cursor}}})(jQuery);